
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://crackmes.blog/2024/02/15/game-crackme/">
      
      
        <link rel="prev" href="../../11/FLAG/">
      
      
        <link rel="next" href="../../24/interesting-crackme/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>RE Challenge: nuts9753's game crackme on crackmes.one - crackmes.blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../termynal.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#re-challenge-nuts9753s-game-crackme-on-crackmesone" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="crackmes.blog" class="md-header__button md-logo" aria-label="crackmes.blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M9.4 86.6c-12.5-12.5-12.5-32.7 0-45.2s32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L178.7 256zM256 416h288c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            crackmes.blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RE Challenge: nuts9753's game crackme on crackmes.one
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../about/" class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../tags/" class="md-tabs__link">
        
  
  
    
  
  Tags

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../category/reverse-engineering/" class="md-tabs__link">
          
  
  
  Categories

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="crackmes.blog" class="md-nav__button md-logo" aria-label="crackmes.blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M9.4 86.6c-12.5-12.5-12.5-32.7 0-45.2s32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L178.7 256zM256 416h288c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>

    </a>
    crackmes.blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/reverse-engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reverse Engineering
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2024-02-15 00:00:00+00:00" class="md-ellipsis">February 15, 2024</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/reverse-engineering/">Reverse Engineering</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              8 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#binary" class="md-nav__link">
    <span class="md-ellipsis">
      Binary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#locate-the-activation-key-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Locate the Activation Key Calculation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../tags/#tag:crackmesone" class="md-tag">crackmes.one</a>
      
    
      
      
      
        <a href="../../../../tags/#tag:x86_64" class="md-tag">x86_64</a>
      
    
  </nav>



<h1 id="re-challenge-nuts9753s-game-crackme-on-crackmesone">RE Challenge: nuts9753's game crackme <a href="https://crackmes.one/crackme/65adde2aeef082e477ff5f56">on crackmes.one</a></h1>
<hr />
<h3 id="binary">Binary</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Name: gameCrackme.exe
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Application Type: Windows(Vista)[AMD64, 64-bit, Console]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$ .\gameCrackme.exe
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>Enter the activation key: test
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>The key is incorrect.
</code></pre></div>
<!-- more -->

<hr />
<h3 id="analysis">Analysis</h3>
<p>We are given the information that the program begins by sending an HTTP request to a local server  to perform a check of the activation code. The first step is to examine the network traffic. To do this, I will start the server, locate the local port it is listening on, then run Wireshark to capture the traffic. </p>
<p>Send the key: (test)
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>GET /check%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00 HTTP/1.1
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Host: 127.0.0.1
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>User-Agent: zig/0.11.0 (std.http)
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>Connection: keep-alive
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>Accept-Encoding: gzip, deflate, zstd
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>TE: gzip, deflate, trailers
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>key: test
</code></pre></div></p>
<p>Server response:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>HTTP/1.1 200 OK
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Connection: keep-alive
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Transfer-Encoding: chunked
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>content-type: text/plain
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>server: crackme :3
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>session-id: 2293003546
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>...
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>false
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>0
</code></pre></div></p>
<p>The server sends a <code>false</code> response with a bad key. </p>
<p>Opening the binary in IDA, we see the prompt for the activation key here:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370AA</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">aEnterTheActiva</span><span class="w"> </span><span class="c1">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370B1</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8d</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="no">Ah</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370B7</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768137CDC</span>
</code></pre></div>
<p>And the subsequent capturing of user input (activation key) here: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370C7</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="no">unk_7FF76817A658</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370CE</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rsi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_70</span><span class="p">]</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370D6</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_B0</span><span class="p">]</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370DB</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rsi</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681370DE</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768131000</span>
</code></pre></div>
<p>The meat of the binary is located in function <code>sub_7FF768131CE9</code>. This section is complicated, with a ton of different paths the code can take. The most important bit that we need to keep track of is that this is where the HTTP client/server functionality resides. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137120</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768131CE9</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137125</span><span class="w">                 </span><span class="no">movzx</span><span class="w">   </span><span class="no">esi</span><span class="p">,</span><span class="w"> </span><span class="no">word</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rsi</span><span class="p">]</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137128</span><span class="w">                 </span><span class="no">test</span><span class="w">    </span><span class="no">si</span><span class="p">,</span><span class="w"> </span><span class="no">si</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813712B</span><span class="w">                 </span><span class="no">jnz</span><span class="w">     </span><span class="no">loc_7FF7681372EA</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137131</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_CE</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137136</span><span class="w">                 </span><span class="no">jnz</span><span class="w">     </span><span class="no">loc_7FF7681372C0</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813713C</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_C0</span><span class="p">],</span><span class="w"> </span><span class="no">r14</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137141</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_B8</span><span class="p">],</span><span class="w"> </span><span class="no">rbx</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137146</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">gs</span><span class="p">:</span><span class="mi">30</span><span class="no">h</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813714F</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">60</span><span class="no">h</span><span class="p">]</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137153</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">20</span><span class="no">h</span><span class="p">]</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137157</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813715B</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">gs</span><span class="p">:</span><span class="mi">30</span><span class="no">h</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137164</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">60</span><span class="no">h</span><span class="p">]</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137168</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">20</span><span class="no">h</span><span class="p">]</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813716C</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">20</span><span class="no">h</span><span class="p">]</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137170</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_A8</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137175</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_A0</span><span class="p">]</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813717A</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="no">rdx</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813717D</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rcx</span><span class="p">],</span><span class="w"> </span><span class="no">rdx</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137180</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">aCongratulation</span><span class="w"> </span><span class="c1">;</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137187</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8d</span><span class="p">,</span><span class="w"> </span><span class="mi">137</span><span class="no">h</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813718D</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768137CDC</span>
</code></pre></div>
<p>Notice the check performed here:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137131</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">108</span><span class="no">h</span><span class="err">+</span><span class="no">var_CE</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<p>If <code>rsp+108h+var_CE</code> equals 1, the function prints the success message, meaning the correct activation key was provided. Otherwise the activation key is incorrect, and the program exits with the message <code>The key is incorrect</code>. We can assume that this value is set during the operation of <code>sub_7FF768131CE9</code>. Too bad we can't patch and move on..</p>
<p>To analyze the HTTP functionality, I'll begin by finding references to the <code>false</code> string. Hopefully this gets us close to where the actual activation-key check occurs. The string has two cross references:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nl">.rdata:</span><span class="err">00007</span><span class="nf">FF76817CFBE</span><span class="w"> </span><span class="no">aFalse</span><span class="w">          </span><span class="no">db</span><span class="w"> </span><span class="err">&#39;</span><span class="no">false</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span><span class="w">            </span><span class="c1">; DATA XREF: sub_7FF76814154E+41A9↑o</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nl">.rdata:</span><span class="err">00007</span><span class="nf">FF76817CFBE</span><span class="w">                                         </span><span class="c1">; sub_7FF76814154E+4210↑o</span>
</code></pre></div>
<p>The first reference <code>sub_7FF76814154E+41A9</code> looks the most interesting:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456F0</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768136E44</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456F5</span><span class="w">                 </span><span class="no">test</span><span class="w">    </span><span class="no">al</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456F7</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">aFalse</span><span class="w">     </span><span class="c1">; &quot;false&quot;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456FE</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">aTrue</span><span class="w">      </span><span class="c1">; &quot;true&quot;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768145705</span><span class="w">                 </span><span class="no">cmovnz</span><span class="w">  </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">rcx</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768145709</span><span class="w">                 </span><span class="no">movzx</span><span class="w">   </span><span class="no">r8d</span><span class="p">,</span><span class="w"> </span><span class="no">al</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76814570D</span><span class="w">                 </span><span class="no">and</span><span class="w">     </span><span class="no">r8d</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768145711</span><span class="w">                 </span><span class="no">xor</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768145715</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_16A8</span><span class="p">]</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76814571D</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF7681413F7</span>
</code></pre></div>
<p>If the return value of <code>sub_7FF768136E44</code> is 1 (al = 1), the <code>true</code> message is passed to <code>sub_7FF7681413F7</code>. Otherwise the <code>false</code> message is passed. </p>
<p>I'll put a breakpoint on <code>sub_7FF768136E44</code> and run the code in the debugger to see what values are passed to the function. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456CB</span><span class="w">                 </span><span class="no">test</span><span class="w">    </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456CE</span><span class="w">                 </span><span class="no">cmovz</span><span class="w">   </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456D2</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456D5</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">unk_7FF7681912D3</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456DC</span><span class="w">                 </span><span class="no">cmovz</span><span class="w">   </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456E0</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B0</span><span class="p">]</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456E8</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r9</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B8</span><span class="p">]</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456F0</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768136E44</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="err">-&gt;</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="nf">rdx</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">4</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="nf">rcx</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">test</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="nf">r8</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B0</span><span class="p">]</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">4235971581</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="nf">r9</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B8</span><span class="p">]</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">(</span><span class="no">decimal</span><span class="p">)</span>
</code></pre></div>
<p>I entered "test" as the activation code in the terminal. It looks as if the function takes two strings and their lengths as input (4 parameters), probably for comparison purposes. Checking the disassembly for <code>sub_7FF768136E44</code> confirms our suspicions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E44</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">r9</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E47</span><span class="w">                 </span><span class="no">jnz</span><span class="w">     </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF768136E6B</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E49</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">r8</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E4C</span><span class="w">                 </span><span class="no">jz</span><span class="w">      </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF768136E6E</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E4E</span><span class="w">                 </span><span class="no">xor</span><span class="w">     </span><span class="no">r9d</span><span class="p">,</span><span class="w"> </span><span class="no">r9d</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="na">...</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E51</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">r9</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E54</span><span class="w">                 </span><span class="no">setz</span><span class="w">    </span><span class="no">al</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E57</span><span class="w">                 </span><span class="no">jz</span><span class="w">      </span><span class="no">short</span><span class="w"> </span><span class="no">locret_7FF768136E6A</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E59</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r10b</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rcx</span><span class="err">+</span><span class="no">r9</span><span class="p">]</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E5D</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">r11</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">r9</span><span class="err">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E61</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="no">r10b</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">r8</span><span class="err">+</span><span class="no">r9</span><span class="p">]</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E65</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r9</span><span class="p">,</span><span class="w"> </span><span class="no">r11</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768136E68</span><span class="w">                 </span><span class="no">jz</span><span class="w">      </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF768136E51</span>
</code></pre></div>
<p>First the string lengths are compared; if they are not equal, the function returns 0. If the lengths are equal, the function then compares each byte of each string. If they match, the function returns 1. Since one parameter to this function was the input string, we can assume that the activation key is the other (4235971581).</p>
<p>Let's test this value. </p>
<p>Tracing the instructions back further, we find <code>r8</code> loaded with the value of the key here:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137B0F</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF76813CFD8</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137B14</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">var_2B0</span><span class="p">]</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137B19</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r9</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">var_2A0</span><span class="p">]</span>
</code></pre></div>
<p><code>sub_7FF76813CFD8</code> sets <code>rsp+2E8h+var_2B0</code> with the value of the key, which is then loaded into <code>r8</code> and subsequently passed to the comparison function. Set a breakpoint on <code>00007FF768137B19</code> then run the debugger and grab the value to input into the activation key prompt:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Enter the activation key: 127099870
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>Congratulations! The key is correct.
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>Now to finish the crackme you need to complete the game and find the code.
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>Imagine that you are in a room with two code panels and a door. To open the door you need to find two codes.
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>Enter the codes in the &quot;code1, code2&quot; format
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>--------------------------------------------
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>Enter the codes:
</code></pre></div>
<p>The key works. Now the game begins, and requests two codes. Following the disassembly in the <code>start</code> routine, we see two candidates for codes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813727D</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="no">aCode1f019</span><span class="w">  </span><span class="c1">; &quot;code@1F019&quot;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137284</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768136E44</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137289</span><span class="w">                 </span><span class="no">test</span><span class="w">    </span><span class="no">al</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813728B</span><span class="w">                 </span><span class="no">jz</span><span class="w">      </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF7681372AD</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813728D</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r9d</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="no">h</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137293</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rsi</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137296</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">r12</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137299</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="no">aCode0011101000</span><span class="w"> </span><span class="c1">;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681372A0</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768136E44</span>
</code></pre></div>
<p>These codes are passed to the same comparison function as the activation key. Performing analysis reveals that the other strings passed to this comparison are calculated from user input. Let's run the binary once again, grab the activation key from the debugger, then enter the codes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Enter the activation key: 956182639
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Congratulations! The key is correct.
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>Now to finish the crackme you need to complete the game and find the code.
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>Imagine that you are in a room with two code panels and a door. To open the door you need to find two codes.
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>Enter the codes in the &quot;code1, code2&quot; format
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>--------------------------------------------
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>Enter the codes: code@1F019,code@00111010_00110011
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>Congratulations!!! :3
</code></pre></div>
<p>Note that the program says to provide the codes with a space in the middle:</p>
<p><code>code@1F019, code@00111010_00110011</code></p>
<p>But this doesn't actually work. The correct string contains no space in between. </p>
<hr />
<h3 id="locate-the-activation-key-calculation">Locate the Activation Key Calculation</h3>
<p>We now have the ability to solve a single iteration of the program, but we haven't solved this generally; the activation key changes every time the program runs. We need to find where the activation key is calculated.  </p>
<p>The actual calculation of this key value occurs in the instructions below. First a call to <code>sub_7FF768159A28</code> returns a value, then based on this value the program calculates the bytes of the activation code by choosing 2 bytes at a time from the string at:</p>
<p><code>.rdata:00007FF7B375D05A a00010203040506</code> </p>
<p>The final key is stored in the stack variable: <code>rsp+r8+2E8h+var_298+0Fh</code>. In my analysis of the program, this key has been between 8 and 10 bytes. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378D5</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">var_E8</span><span class="p">]</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378DD</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">name</span><span class="p">]</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378E2</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8d</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378E8</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">rdi</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378EB</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768159A28</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378F0</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">var_2B8</span><span class="p">]</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378F5</span><span class="w">                 </span><span class="no">and</span><span class="w">     </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378F9</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">edi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rdi</span><span class="p">]</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681378FB</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">var_2B0</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137900</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8d</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="no">h</span><span class="w"> </span><span class="c1">; &#39; &#39;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137906</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="no">h</span><span class="w"> </span><span class="c1">; &#39;d&#39;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813790B</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">r15</span><span class="p">,</span><span class="w"> </span><span class="no">a00010203040506</span><span class="w"> </span><span class="c1">; </span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137912</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">edi</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137914</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="no">h</span><span class="w"> </span><span class="c1">; &#39;d&#39;</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137917</span><span class="w">                 </span><span class="no">jb</span><span class="w">      </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF76813798B</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137919</span><span class="w">                 </span><span class="no">xor</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="no">edx</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813791B</span><span class="w">                 </span><span class="no">div</span><span class="w">     </span><span class="no">ecx</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813791D</span><span class="w">                 </span><span class="no">movzx</span><span class="w">   </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="no">word</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r15</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137922</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">word</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">r8</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">var_298</span><span class="err">+</span><span class="mi">0</span><span class="no">Fh</span><span class="p">],</span><span class="w"> </span><span class="no">dx</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137928</span><span class="w">                 </span><span class="no">add</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">FFFFFFFFFFFFFFFEh</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813792C</span><span class="w">                 </span><span class="no">jmp</span><span class="w">     </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF768137914</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="na">...</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813798B</span><span class="w">                 </span><span class="no">cmp</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF76813798E</span><span class="w">                 </span><span class="no">ja</span><span class="w">      </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF7681379EC</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137990</span><span class="w">                 </span><span class="no">add</span><span class="w">     </span><span class="no">al</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="no">h</span><span class="w"> </span><span class="c1">; &#39;0&#39;</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137992</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">byte</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">r8</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">name.sa_family</span><span class="p">],</span><span class="w"> </span><span class="no">al</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF768137997</span><span class="w">                 </span><span class="no">jmp</span><span class="w">     </span><span class="no">short</span><span class="w"> </span><span class="no">loc_7FF7681379FC</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="na">...</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681379EC</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">eax</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681379EE</span><span class="w">                 </span><span class="no">movzx</span><span class="w">   </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">word</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r15</span><span class="err">+</span><span class="no">rax</span><span class="p">*</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681379F3</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">word</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">r8</span><span class="err">+</span><span class="mi">2</span><span class="no">E8h</span><span class="err">+</span><span class="no">var_298</span><span class="err">+</span><span class="mi">0</span><span class="no">Fh</span><span class="p">],</span><span class="w"> </span><span class="no">ax</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681379F9</span><span class="w">                 </span><span class="no">dec</span><span class="w">     </span><span class="no">r8</span>
</code></pre></div>
<p>It is my determination that <code>sub_7FF768159A28</code> is actually the Windows API function <code>CryptGenRandom</code>. This call produces a 4-byte random seed that the program uses to calculate the activation key. Because of this, it will be impossible for us to create a keygen to calculate this value at runtime. We will have to resort to other methods to obtain the key. </p>
<hr />
<p>Returning to the call of the comparison function discussed earlier:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456CB</span><span class="w">                 </span><span class="no">test</span><span class="w">    </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456CE</span><span class="w">                 </span><span class="no">cmovz</span><span class="w">   </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456D2</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456D5</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">unk_7FF7681912D3</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456DC</span><span class="w">                 </span><span class="no">cmovz</span><span class="w">   </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456E0</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B0</span><span class="p">]</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456E8</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r9</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B8</span><span class="p">]</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681456F0</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF768136E44</span>
</code></pre></div>
<p>and scrolling up in the disassembly with <code>arg_1B0</code> selected, shows where the activation key value is used in other areas of the program. A hint is provided at <code>00007FF7681448DF</code> that this value might also be used as a session ID. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681448C4</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B8</span><span class="p">]</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681448CC</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">var_20</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681448D1</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r8d</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">Ah</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681448D7</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_57F0</span><span class="p">]</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681448DF</span><span class="w">                 </span><span class="no">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">aSessionId</span><span class="w"> </span><span class="c1">; &quot;session-id&quot;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681448E6</span><span class="w">                 </span><span class="no">mov</span><span class="w">     </span><span class="no">r9</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="no">h</span><span class="err">+</span><span class="no">arg_1B0</span><span class="p">]</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="nl">.text:</span><span class="err">00007</span><span class="nf">FF7681448EE</span><span class="w">                 </span><span class="no">call</span><span class="w">    </span><span class="no">sub_7FF76813129C</span>
</code></pre></div>
<p>In our initial analysis of the network traffic, the session key <code>2293003546</code> did look quite familiar to the activation key format we're seeing now. </p>
<p>Let's try it out. First start the program in its own windows terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>.\gameCrackme.exe
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Enter the activation key: 
</code></pre></div>
<p>Before entering an activation key, query the netstat table for the web server port:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>netstat -ano -p tcp
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>&lt;SNIP&gt;
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a> TCP    127.0.0.1:14495        0.0.0.0:0              LISTENING
</code></pre></div>
<p>Send a request to the web server to get the current session key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>curl.exe -v http://localhost:14495/check
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>&lt;SNIP&gt;
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>&lt; HTTP/1.1 200 OK
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>&lt; Connection: close
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>&lt; Transfer-Encoding: chunked
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>&lt; content-type: text/plain
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>&lt; server: crackme :3
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>&lt; session-id: 1047554161
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>&lt;
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>false* Closing connection
</code></pre></div>
<p>Enter the key into the program:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>.\gameCrackme.exe
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>Enter the activation key: 1047554161
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>Congratulations! The key is correct.
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>Now to finish the crackme you need to complete the game and find the code.
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>Imagine that you are in a room with two code panels and a door. To open the door you need to find two codes.
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>Enter the codes in the &quot;code1, code2&quot; format
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>--------------------------------------------
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>Enter the codes: code@1F019,code@00111010_00110011
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>Congratulations!!! :3
</code></pre></div>







  
  




  



      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../../../termynal.js"></script>
      
    
  </body>
</html>